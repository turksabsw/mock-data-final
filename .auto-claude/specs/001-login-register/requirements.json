{
  "task_description": "# VISE OS — VFS Global Register & Login Bot: Master Prompt\n\n> **Bu dosyayı yapay zekaya (Claude, Cursor, Copilot vb.) ver ve \"Emret, yapsın\" mantığıyla geliştirme sürecini başlat.**\n> Bağlam dosyaları olarak `@yol_haritasi.md` ve `@VISE_OS_VFS_Camoufox_Arastirma_Raporu_TR_macOS.md` dosyalarını da ekle.\n\n---\n\n## SEN KİMSİN\n\nSen, VISE OS projesinin tek geliştiricisiyle çalışan bir senior full-stack otomasyon mühendisisin. Görevin, VFS Global web sitesinde otomatik hesap oluşturma (register) ve giriş (login) yapabilen bir Python botu geliştirmektir.\n\n## PROJE BAĞLAMI\n\n- **Ana hedef:** Playwright + Camoufox kullanarak VFS Global üzerinden register olup login yapabilmek\n- **Çalışma platformu:** Cross-platform (macOS, Windows, Linux) — bot hangi OS'ta çalışırsa çalışsın uyum sağlamalı\n- **Dil:** Python 3.11+\n- **Tarayıcı:** Camoufox (Firefox fork, C++ seviyesinde anti-detect)\n- **Protokol:** Juggler (CDP değil — bu kritik, anti-bot tespiti açısından)\n- **Mail:** Mailcow mail server (atonota.com domain) + n8n ile otomatik doğrulama\n- **Hedef siteler:** `https://visa.vfsglobal.com/tur/en/{ULKE_KODU}/` — Türkiye çıkışlı tüm VFS Global ülkeleri\n- **MVP test ülkesi:** Düşük korumalı bir ülke (ör. `aut`, `hrv`, `che`) ile başla, sonra `ita`, `nld` gibi yoğun rotalara geç\n- **Yol haritası:** `@yol_haritasi.md` dosyasını referans al\n- **Teknik araştırma:** `@VISE_OS_VFS_Camoufox_Arastirma_Raporu_TR_macOS.md` dosyasını referans al\n\n## TEKNİK MİMARİ KURALLARI\n\n### Cross-Platform Algılama (Zorunlu)\n\nBot, çalıştığı işletim sistemini otomatik algılamalı ve platform-spesifik ayarları buna göre yapmalıdır. **Çalışma OS'u** (botun çalıştığı makine) ile **parmak izi OS'u** (VFS'e gösterilecek sahte kimlik) iki farklı kavramdır.\n\n```python\nimport platform, os, random\n\ndef platform_ayarlari_al():\n    \"\"\"Çalışma ortamını algıla, platform-spesifik yolları ve headless modunu belirle.\"\"\"\n    sistem = platform.system()  # \"Darwin\" (macOS), \"Windows\", \"Linux\"\n    \n    ayarlar = {\n        \"sistem\": sistem,\n        \"headless\": False,\n        \"profile_dir\": \"\",\n        \"debug_dir\": \"\",\n        \"xvfb_gerekli\": False,\n    }\n    \n    if sistem == \"Darwin\":  # macOS\n        ayarlar[\"headless\"] = False\n        ayarlar[\"profile_dir\"] = os.path.expanduser(\n            \"~/Library/Application Support/VISE-OS/vfs-profile\"\n        )\n        ayarlar[\"debug_dir\"] = os.path.expanduser(\"~/vise-os-bot/debug\")\n        \n    elif sistem == \"Windows\":\n        ayarlar[\"headless\"] = False\n        ayarlar[\"profile_dir\"] = os.path.join(\n            os.environ.get(\"APPDATA\", \"C:\\\\Users\\\\Default\\\\AppData\\\\Roaming\"),\n            \"VISE-OS\", \"vfs-profile\"\n        )\n        ayarlar[\"debug_dir\"] = os.path.join(\n            os.environ.get(\"USERPROFILE\", \"C:\\\\Users\\\\Default\"),\n            \"vise-os-bot\", \"debug\"\n        )\n        \n    elif sistem == \"Linux\":\n        ayarlar[\"headless\"] = \"virtual\"  # Xvfb — sunucuda GUI yok\n        ayarlar[\"xvfb_gerekli\"] = True\n        ayarlar[\"profile_dir\"] = os.path.expanduser(\"~/.config/vise-os/vfs-profile\")\n        ayarlar[\"debug_dir\"] = os.path.expanduser(\"~/vise-os-bot/debug\")\n    \n    # Dizinleri oluştur\n    os.makedirs(ayarlar[\"profile_dir\"], exist_ok=True)\n    os.makedirs(ayarlar[\"debug_dir\"], exist_ok=True)\n    \n    return ayarlar\n```\n\n### Parmak İzi OS Rotasyonu (Çalışma OS'undan Bağımsız)\n\nCamoufox'un `os` parametresi, VFS'e gösterilecek sahte parmak izini belirler. Bu, botun çalıştığı gerçek OS'tan **bağımsızdır**. Türkiye'deki gerçek kullanıcı dağılımını yansıtan ağırlıklı rastgele seçim kullan:\n\n```python\ndef parmak_izi_os_sec():\n    \"\"\"VFS'e gösterilecek sahte OS'u gerçekçi dağılımla seç.\n    Türkiye'deki masaüstü OS dağılımı: ~%75 Windows, ~%17 macOS, ~%8 Linux\n    \"\"\"\n    return random.choices(\n        population=[\"windows\", \"macos\", \"linux\"],\n        weights=[75, 17, 8],\n        k=1\n    )[0]\n```\n\n### Camoufox Konfigürasyonu (Her Zaman Uygula)\n\n```python\ndef camoufox_config_olustur(ulke_kodu: str = \"ita\", proxy: dict = None):\n    \"\"\"Platform-agnostik, ülke-agnostik Camoufox konfigürasyonu üret.\"\"\"\n    p = platform_ayarlari_al()\n    \n    config = {\n        \"headless\": p[\"headless\"],       # Platform'a göre otomatik\n        \"humanize\": True,                # İnsan benzeri fare hareketi — zorunlu\n        \"os\": parmak_izi_os_sec(),       # Rastgele parmak izi OS'u — her oturumda farklı\n        \"geoip\": True,                   # Proxy IP'den otomatik timezone/locale\n        \"disable_coop\": True,            # Cloudflare Turnstile iframe erişimi — zorunlu\n        \"persistent_context\": True,      # Çerez saklama — cf_clearance tekrar kullanımı\n        \"user_data_dir\": os.path.join(   # Ülke bazlı ayrı profil\n            p[\"profile_dir\"], ulke_kodu\n        ),\n    }\n    \n    if proxy:\n        config[\"proxy\"] = proxy\n    \n    return config\n```\n\n### Çoklu Ülke Mimarisi\n\nBot, Türkiye çıkışlı tüm VFS Global ülkelerini desteklemeli. URL yapısı aynı, sadece ülke kodu değişiyor. Ancak **her ülkenin CAPTCHA tipi, form alanları ve Cloudflare agresifliği farklı olabilir.**\n\n#### Ülke Konfigürasyon Dosyası: `config/countries.json`\n\n```json\n{\n  \"_meta\": {\n    \"aciklama\": \"VFS Global Türkiye çıkışlı ülke konfigürasyonları\",\n    \"origin\": \"tur\",\n    \"language\": \"en\",\n    \"url_sablonu\": \"https://visa.vfsglobal.com/tur/en/{ulke_kodu}/{sayfa}\"\n  },\n  \"ulkeler\": {\n    \"ita\": {\n      \"isim\": \"İtalya\",\n      \"provider\": \"vfs\",\n      \"aktif\": true,\n      \"oncelik\": \"yuksek\",\n      \"captcha_tipi\": null,\n      \"otp_zorunlu\": null,\n      \"selectors_dosyasi\": \"config/selectors/vfs_ita.json\",\n      \"notlar\": \"Yoğun talep, agresif Cloudflare — keşif sonrası doldurulacak\"\n    },\n    \"nld\": {\n      \"isim\": \"Hollanda\",\n      \"provider\": \"vfs\",\n      \"aktif\": true,\n      \"oncelik\": \"yuksek\",\n      \"captcha_tipi\": null,\n      \"otp_zorunlu\": null,\n      \"selectors_dosyasi\": \"config/selectors/vfs_nld.json\",\n      \"notlar\": \"Yoğun talep — keşif sonrası doldurulacak\"\n    },\n    \"aut\": {\n      \"isim\": \"Avusturya\",\n      \"provider\": \"vfs\",\n      \"aktif\": true,\n      \"oncelik\": \"orta\",\n      \"captcha_tipi\": null,\n      \"otp_zorunlu\": null,\n      \"selectors_dosyasi\": \"config/selectors/vfs_aut.json\",\n      \"notlar\": \"Düşük talep — MVP test adayı\"\n    },\n    \"che\": {\n      \"isim\": \"İsviçre\",\n      \"provider\": \"vfs\",\n      \"aktif\": true,\n      \"oncelik\": \"orta\",\n      \"captcha_tipi\": null,\n      \"otp_zorunlu\": null,\n      \"selectors_dosyasi\": \"config/selectors/vfs_che.json\",\n      \"notlar\": \"Düşük talep — MVP test adayı\"\n    },\n    \"bel\": {\n      \"isim\": \"Belçika\",\n      \"provider\": \"vfs\",\n      \"aktif\": true,\n      \"oncelik\": \"orta\",\n      \"captcha_tipi\": null,\n      \"otp_zorunlu\": null,\n      \"selectors_dosyasi\": \"config/selectors/vfs_bel.json\",\n      \"notlar\": \"Keşif sonrası doldurulacak\"\n    },\n    \"hrv\": {\n      \"isim\": \"Hırvatistan\",\n      \"provider\": \"vfs\",\n      \"aktif\": true,\n      \"oncelik\": \"dusuk\",\n      \"captcha_tipi\": null,\n      \"otp_zorunlu\": null,\n      \"selectors_dosyasi\": \"config/selectors/vfs_hrv.json\",\n      \"notlar\": \"Düşük talep, düşük koruma — MVP test adayı\"\n    },\n    \"cze\": {\n      \"isim\": \"Çekya\",\n      \"provider\": \"vfs\",\n      \"aktif\": true,\n      \"oncelik\": \"orta\",\n      \"captcha_tipi\": null,\n      \"otp_zorunlu\": null,\n      \"selectors_dosyasi\": \"config/selectors/vfs_cze.json\",\n      \"notlar\": \"Keşif sonrası doldurulacak\"\n    },\n    \"irl\": {\n      \"isim\": \"İrlanda\",\n      \"provider\": \"vfs\",\n      \"aktif\": true,\n      \"oncelik\": \"dusuk\",\n      \"captcha_tipi\": null,\n      \"otp_zorunlu\": null,\n      \"selectors_dosyasi\": \"config/selectors/vfs_irl.json\",\n      \"notlar\": \"Keşif sonrası doldurulacak\"\n    },\n    \"deu\": {\n      \"isim\": \"Almanya\",\n      \"provider\": \"auslandsportal\",\n      \"aktif\": false,\n      \"oncelik\": \"yok\",\n      \"notlar\": \"⚠️ VFS DEĞİL — Auslandsportal (digital.diplo.de) kullanıyor. Ayrı adapter gerekli.\"\n    },\n    \"fra\": {\n      \"isim\": \"Fransa\",\n      \"provider\": \"tlscontact\",\n      \"aktif\": false,\n      \"oncelik\": \"yok\",\n      \"notlar\": \"⚠️ VFS DEĞİL — TLScontact kullanıyor. Ayrı adapter gerekli.\"\n    },\n    \"gbr\": {\n      \"isim\": \"İngiltere\",\n      \"provider\": \"tlscontact\",\n      \"aktif\": false,\n      \"oncelik\": \"yok\",\n      \"notlar\": \"⚠️ VFS DEĞİL — TLScontact kullanıyor. Ayrı adapter gerekli.\"\n    }\n  }\n}\n```\n\n#### Ülke Yönetici Sınıfı\n\n```python\nimport json, os\n\nclass UlkeYonetici:\n    \"\"\"Ülke konfigürasyonlarını yükle ve yönet.\"\"\"\n    \n    def __init__(self, config_yolu=\"config/countries.json\"):\n        with open(config_yolu, \"r\", encoding=\"utf-8\") as f:\n            self.config = json.load(f)\n        self.url_sablonu = self.config[\"_meta\"][\"url_sablonu\"]\n    \n    def ulke_al(self, ulke_kodu: str) -> dict:\n        \"\"\"Belirli bir ülkenin konfigürasyonunu döndür.\"\"\"\n        ulke = self.config[\"ulkeler\"].get(ulke_kodu)\n        if not ulke:\n            raise ValueError(f\"Bilinmeyen ülke kodu: {ulke_kodu}\")\n        if ulke[\"provider\"] != \"vfs\":\n            raise ValueError(f\"{ulke['isim']} VFS değil → {ulke['provider']}\")\n        if not ulke.get(\"aktif\", False):\n            raise ValueError(f\"{ulke['isim']} aktif değil.\")\n        return ulke\n    \n    def url_olustur(self, ulke_kodu: str, sayfa: str = \"login\") -> str:\n        \"\"\"Ülke koduna göre VFS URL'si üret.\"\"\"\n        self.ulke_al(ulke_kodu)\n        return self.url_sablonu.format(ulke_kodu=ulke_kodu, sayfa=sayfa)\n    \n    def aktif_vfs_ulkeleri(self) -> list:\n        \"\"\"Aktif VFS ülkelerinin listesini döndür.\"\"\"\n        return [\n            kod for kod, bilgi in self.config[\"ulkeler\"].items()\n            if bilgi.get(\"aktif\") and bilgi.get(\"provider\") == \"vfs\"\n        ]\n    \n    def selectors_yukle(self, ulke_kodu: str) -> dict:\n        \"\"\"Ülkeye özel selector dosyasını yükle. Yoksa genel şablon döndür.\"\"\"\n        ulke = self.ulke_al(ulke_kodu)\n        dosya = ulke.get(\"selectors_dosyasi\")\n        if dosya and os.path.exists(dosya):\n            with open(dosya, \"r\", encoding=\"utf-8\") as f:\n                return json.load(f)\n        return GENEL_VFS_SELECTOR_SABLONU\n\nGENEL_VFS_SELECTOR_SABLONU = {\n    \"register\": {\n        \"first_name\":       {\"primary\": \"input[data-testid='firstName']\",     \"fallback_1\": \"input[name='firstName']\",      \"fallback_2\": \"input[id='firstName']\",                          \"ai_hint\": \"Ad giriş alanı\"},\n        \"last_name\":        {\"primary\": \"input[data-testid='lastName']\",      \"fallback_1\": \"input[name='lastName']\",       \"fallback_2\": \"input[id='lastName']\",                           \"ai_hint\": \"Soyad giriş alanı\"},\n        \"email\":            {\"primary\": \"input[data-testid='email']\",         \"fallback_1\": \"input[type='email']\",          \"fallback_2\": \"input[name='email'], #email\",                    \"ai_hint\": \"E-posta giriş alanı\"},\n        \"password\":         {\"primary\": \"input[data-testid='password']\",      \"fallback_1\": \"input[type='password']\",       \"fallback_2\": \"input[name='password']\",                         \"ai_hint\": \"Şifre giriş alanı\"},\n        \"password_confirm\": {\"primary\": \"input[data-testid='confirmPassword']\",\"fallback_1\": \"input[type='password']:nth-of-type(2)\", \"fallback_2\": \"input[name='confirmPassword']\",       \"ai_hint\": \"Şifre tekrar alanı\"},\n        \"terms_checkbox\":   {\"primary\": \"input[data-testid='terms']\",         \"fallback_1\": \"input[type='checkbox']\",       \"fallback_2\": \"input[name='terms'], input[name='agree']\",       \"ai_hint\": \"Kullanım koşulları onay kutusu\"},\n        \"submit\":           {\"primary\": \"button[data-testid='register-submit']\",\"fallback_1\": \"button[type='submit']\",      \"fallback_2\": \"input[type='submit']\",                           \"ai_hint\": \"Kayıt ol butonu\"}\n    },\n    \"login\": {\n        \"email\":     {\"primary\": \"input[data-testid='email']\",    \"fallback_1\": \"input[type='email']\",    \"fallback_2\": \"input[name='email'], #email\",           \"ai_hint\": \"E-posta giriş alanı\"},\n        \"password\":  {\"primary\": \"input[data-testid='password']\", \"fallback_1\": \"input[type='password']\", \"fallback_2\": \"input[name='password']\",                \"ai_hint\": \"Şifre giriş alanı\"},\n        \"submit\":    {\"primary\": \"button[data-testid='login-submit']\",\"fallback_1\": \"button[type='submit']\",\"fallback_2\": \"//button[contains(text(),'Sign')]\",  \"ai_hint\": \"Giriş yap butonu\"},\n        \"otp_input\": {\"primary\": \"input[data-testid='otp']\",     \"fallback_1\": \"input[name='otp']\",      \"fallback_2\": \"input[placeholder*='OTP'], input[placeholder*='code']\", \"ai_hint\": \"OTP kodu giriş alanı\"}\n    }\n}\n```\n\n### Dosya Yapısı (Bu Yapıya Uy)\n\n```\n~/vise-os-bot/\n├── .env                              # Hassas bilgiler — GIT'E EKLEME\n├── config/\n│   ├── countries.json                # Tüm ülke konfigürasyonları\n│   ├── proxy_list.json               # Proxy listesi\n│   └── selectors/                    # Ülke bazlı selector dosyaları\n│       ├── vfs_ita.json              # (keşif sonrası doldurulacak)\n│       ├── vfs_nld.json\n│       ├── vfs_aut.json\n│       └── ...\n├── src/\n│   ├── __init__.py\n│   ├── platform_config.py            # Cross-platform algılama + parmak izi rotasyonu\n│   ├── country_manager.py            # Ülke konfigürasyon yönetimi\n│   ├── browser.py                    # Camoufox başlatma ve yönetim\n│   ├── register.py                   # Register akışı (ülke-agnostik)\n│   ├── login.py                      # Login akışı — OTP dahil (ülke-agnostik)\n│   ├── otp_reader.py                 # Mailcow IMAP OTP okuyucu\n│   ├── captcha_solver.py             # CAPTCHA çözüm stratejileri\n│   └── utils.py                      # log, screenshot, bekleme fonksiyonları\n├── tests/\n│   ├── test_camoufox_health.py\n│   ├── test_platform_detection.py\n│   ├── test_register_e2e.py\n│   └── test_login_e2e.py\n├── debug/\n│   ├── screenshots/\n│   ├── har/\n│   └── logs/\n└── main.py                           # CLI giriş noktası: python main.py register -c aut\n```\n\n### .env Dosyası Formatı\n\n```env\n# === VFS Global ===\nVFS_ORIGIN=tur\nVFS_LANGUAGE=en\nVFS_DEFAULT_COUNTRY=aut\nVFS_EMAIL=test001@atonota.com\nVFS_PASSWORD=GucluSifre123!\nVFS_FIRST_NAME=Test\nVFS_LAST_NAME=Kullanici\n\n# === Mailcow ===\nMAILCOW_HOST=mail.atonota.com\nMAILCOW_USER=test001@atonota.com\nMAILCOW_PASS=MailKutusuSifresi\nMAILCOW_PORT=993\n\n# === Proxy (opsiyonel — başlangıçta olmayabilir) ===\nPROXY_SERVER=http://proxy:8080\nPROXY_USERNAME=user\nPROXY_PASSWORD=pass\n\n# === CAPTCHA (opsiyonel — gerekirse) ===\nCAPSOLVER_API_KEY=CAP-xxxx\n\n# === Yollar (boş bırakılırsa platform otomatik algılar) ===\nPROFILE_DIR=\nDEBUG_DIR=\n```\n\n### Ana Giriş Noktası: `main.py`\n\n```python\n\"\"\"VISE OS Bot — Ana giriş noktası.\nKullanım:\n    python main.py register --country aut\n    python main.py login --country aut\n    python main.py test --country aut\n\"\"\"\nimport argparse\nfrom src.platform_config import platform_ayarlari_al\nfrom src.country_manager import UlkeYonetici\nfrom src.register import register_yap\nfrom src.login import login_yap\nfrom src.utils import log\n\ndef main():\n    parser = argparse.ArgumentParser(description=\"VISE OS — VFS Global Bot\")\n    parser.add_argument(\"aksiyon\", choices=[\"register\", \"login\", \"test\"],\n                        help=\"Yapılacak işlem\")\n    parser.add_argument(\"--country\", \"-c\", required=True,\n                        help=\"VFS ülke kodu (ör: ita, nld, aut, hrv)\")\n    args = parser.parse_args()\n    \n    p = platform_ayarlari_al()\n    uy = UlkeYonetici()\n    ulke = uy.ulke_al(args.country)\n    \n    log(f\"[SISTEM] Platform: {p['sistem']} | Ülke: {ulke['isim']} ({args.country}) | Aksiyon: {args.aksiyon}\")\n    \n    if args.aksiyon == \"register\":\n        register_yap(args.country)\n    elif args.aksiyon == \"login\":\n        login_yap(args.country)\n    elif args.aksiyon == \"test\":\n        register_yap(args.country)\n        login_yap(args.country)\n\nif __name__ == \"__main__\":\n    main()\n```\n\n## KOD YAZMA KURALLARI\n\n### 1. Her Fonksiyona Debug Yeteneği Ekle\n```python\n# ✅ DOĞRU — Her kritik adımda log + screenshot\ndef login_yap(page, email, sifre):\n    log(\"[LOGIN] Başlıyor...\")\n    try:\n        page.fill(\"input[type='email']\", email)\n        log(\"[LOGIN] E-posta girildi\")\n        screenshot_al(page, \"login_email_girildi\")\n        \n        page.fill(\"input[type='password']\", sifre)\n        log(\"[LOGIN] Şifre girildi\")\n        \n        page.click(\"button[type='submit']\")\n        log(\"[LOGIN] Submit tıklandı\")\n        screenshot_al(page, \"login_submit_sonrasi\")\n        \n    except Exception as e:\n        log(f\"[LOGIN][HATA] {e}\")\n        screenshot_al(page, \"login_hata\")\n        har_kaydet(page, \"login_hata\")\n        raise\n\n# ❌ YANLIŞ — Debug bilgisi olmayan kör kod\ndef login_yap(page, email, sifre):\n    page.fill(\"input[type='email']\", email)\n    page.fill(\"input[type='password']\", sifre)\n    page.click(\"button[type='submit']\")\n```\n\n### 2. Selector Stratejisi (Ülke Bazlı, Kademeli Fallback)\n```python\ndef element_bul(page, ulke_kodu, sayfa, alan_adi, timeout=15000):\n    \"\"\"Kademeli selector ile element bul. Ülke bazlı selector dosyasından okur.\"\"\"\n    uy = UlkeYonetici()\n    selectors = uy.selectors_yukle(ulke_kodu)\n    sel = selectors.get(sayfa, {}).get(alan_adi, {})\n    if not sel:\n        raise Exception(f\"Selector tanımı yok: {ulke_kodu}/{sayfa}/{alan_adi}\")\n    \n    for kademe in [\"primary\", \"fallback_1\", \"fallback_2\"]:\n        try:\n            element = page.wait_for_selector(sel[kademe], timeout=timeout // 3)\n            if element:\n                log(f\"[SELECTOR] {alan_adi} → {kademe} ile bulundu\")\n                return element\n        except:\n            log(f\"[SELECTOR] {alan_adi} → {kademe} başarısız...\")\n    \n    log(f\"[SELECTOR][KRİTİK] {alan_adi} bulunamadı! ai_hint: {sel.get('ai_hint','yok')}\")\n    screenshot_al(page, f\"selector_bulunamadi_{alan_adi}\")\n    raise Exception(f\"Element bulunamadı: {ulke_kodu}/{sayfa}/{alan_adi}\")\n```\n\n### 3. İnsan Benzeri Davranış (Zorunlu)\n```python\nimport random, time\n\ndef insan_gibi_bekle(min_sn=1.0, max_sn=3.0):\n    time.sleep(random.uniform(min_sn, max_sn))\n\ndef insan_gibi_yaz(page, selector, metin):\n    element = page.locator(selector)\n    element.click()\n    insan_gibi_bekle(0.3, 0.8)\n    for karakter in metin:\n        element.type(karakter, delay=random.randint(50, 150))\n    insan_gibi_bekle(0.5, 1.5)\n```\n\n### 4. Hata Yakalama Şablonu\n```python\ndef akis_calistir(adim_adi, fonksiyon, page, *args, **kwargs):\n    try:\n        log(f\"[{adim_adi}] Başlıyor...\")\n        sonuc = fonksiyon(page, *args, **kwargs)\n        log(f\"[{adim_adi}] ✓ Başarılı\")\n        return sonuc\n    except TimeoutError:\n        log(f\"[{adim_adi}] ✗ TIMEOUT\")\n        screenshot_al(page, f\"{adim_adi}_timeout\")\n        raise\n    except Exception as e:\n        log(f\"[{adim_adi}] ✗ HATA: {type(e).__name__}: {e}\")\n        screenshot_al(page, f\"{adim_adi}_hata\")\n        raise\n```\n\n### 5. Loglama Standardı (Cross-Platform)\n```python\nimport datetime, os\nfrom src.platform_config import platform_ayarlari_al\n\n_p = platform_ayarlari_al()\nLOG_DIR = os.path.join(_p[\"debug_dir\"], \"logs\")\nSS_DIR = os.path.join(_p[\"debug_dir\"], \"screenshots\")\nos.makedirs(LOG_DIR, exist_ok=True)\nos.makedirs(SS_DIR, exist_ok=True)\n\ndef log(mesaj):\n    zaman = datetime.datetime.now().strftime(\"%Y-%m-%d %H:%M:%S.%f\")[:-3]\n    satir = f\"[{zaman}] {mesaj}\"\n    print(satir)\n    with open(os.path.join(LOG_DIR, f\"vise_{datetime.date.today()}.log\"), \"a\", encoding=\"utf-8\") as f:\n        f.write(satir + \"\\n\")\n\ndef screenshot_al(page, isim):\n    zaman = datetime.datetime.now().strftime(\"%H%M%S\")\n    dosya = os.path.join(SS_DIR, f\"{zaman}_{isim}.png\")\n    page.screenshot(path=dosya)\n    log(f\"[SCREENSHOT] {dosya}\")\n```\n\n## GELİŞTİRME SIRASI\n\n> Aşağıdaki sırayı takip et. Her adımı tamamlamadan sonrakine geçme. `@yol_haritasi.md` ile senkronize çalış.\n\n### ADIM 1: Proje iskeleti oluştur\n- `~/vise-os-bot/` dizinini ve tüm alt klasörleri oluştur\n- `.env` dosyasını oluştur (placeholder değerlerle)\n- `config/countries.json` dosyasını oluştur\n- `config/selectors/` klasörünü oluştur (boş)\n\n### ADIM 2: `src/platform_config.py` — Cross-platform algılama\n- `platform_ayarlari_al()`, `parmak_izi_os_sec()`, `camoufox_config_olustur()`\n\n### ADIM 3: `src/country_manager.py` — Ülke yönetimi\n- `UlkeYonetici` sınıfı + genel selector şablonu\n\n### ADIM 4: `src/utils.py` — Ortak fonksiyonlar\n- `log()`, `screenshot_al()`, `insan_gibi_bekle()`, `insan_gibi_yaz()`, `element_bul()`\n\n### ADIM 5: `src/browser.py` — Camoufox yönetimi\n- `tarayici_baslat(ulke_kodu)`, `sayfa_git(page, url)`\n- Test: Google.com + bot tespit siteleri\n\n### ADIM 6: `src/otp_reader.py` — Mail okuyucu\n- Mailcow IMAP bağlantısı, OTP çekme, doğrulama linki çekme\n\n### ADIM 7: `src/captcha_solver.py` — CAPTCHA çözücü\n- Turnstile / reCAPTCHA / hCaptcha iskeletleri + CapSolver API\n\n### ADIM 8: `src/register.py` — Kayıt akışı (ülke-agnostik)\n- `register_yap(ulke_kodu)` — URL ve selector'ları config'den okur\n\n### ADIM 9: `src/login.py` — Giriş akışı (ülke-agnostik)\n- `login_yap(ulke_kodu)` — OTP entegrasyonu dahil\n\n### ADIM 10: `main.py` — CLI giriş noktası\n- `python main.py register -c aut` / `python main.py login -c aut` / `python main.py test -c aut`\n\n### ADIM 11: `tests/` — Testler\n- `test_platform_detection.py`, `test_register_e2e.py`, `test_login_e2e.py`\n\n## YASAKLAR — YAPMA\n\n1. **Headless mode kullanma** — `headless=True` kullanma. `headless=False` veya `headless=\"virtual\"` kullan.\n2. **CDP protokolü kullanma** — Playwright'ı doğrudan Chromium ile başlatma. Camoufox wrapper'ını kullan.\n3. **Sabit zamanlama kullanma** — `time.sleep(2)` yapma. Her zaman `random.uniform(min, max)` kullan.\n4. **Datacenter proxy kullanma** — Residential veya mobile proxy zorunlu.\n5. **Hata yutma** — Boş `except: pass` yazma. Her hatayı logla ve screenshot al.\n6. **Selector'ları hardcode etme** — `config/selectors/` dosyalarından oku, kademeli fallback kullan.\n7. **Tek satırda form doldurma** — Öncesinde `.click()` ve araya `insan_gibi_bekle()` ekle.\n8. **Hassas bilgileri koda gömme** — `.env` dosyasından oku.\n9. **JS ile webdriver gizleme** — Camoufox C++ seviyesinde halleder, JS yaması ekleme.\n10. **Sabit `os` parametresi kullanma** — `parmak_izi_os_sec()` kullan, her oturumda rastgele.\n11. **Ülke kodunu hardcode etme** — `UlkeYonetici.url_olustur(ulke_kodu, sayfa)` kullan.\n12. **Platform yollarını hardcode etme** — `platform_ayarlari_al()` kullan.\n\n## KRİTİK HATIRLATMALAR\n\n- **VFS Global hesap yasakları kalıcıdır.** Her test turunda mümkünse yeni hesap kullan.\n- **OTP 60-90 saniye geçerlidir.** Pipeline 30 saniyenin altında tamamlanmalı.\n- **cf_clearance çerezi persistent_context ile saklanır.** Yeniden challenge'dan kaçınır.\n- **Her hata debug dizinine kayıt edilmeli.** \"Nerede patladık?\" her zaman cevaplanabilir olmalı.\n- **MVP için düşük korumalı ülkeyle başla.** Avusturya, Hırvatistan veya İsviçre ile başla.\n- **Her ülke için bir kez manuel keşif gerekecek.** Selector'lar ülkeden ülkeye değişebilir.\n- **Parmak izi OS'u her oturumda değişsin.** Tekrar eden iz Cloudflare'ı tetikler.\n\n## SORU SORMA KURALI\n\n1. Önce `@VISE_OS_VFS_Camoufox_Arastirma_Raporu_TR_macOS.md` dosyasına bak\n2. Sonra `@yol_haritasi.md` dosyasına bak\n3. Hâlâ belirsizse, **ne denediğini ve nerede patladığını** açıklayarak sor\n4. \"Bilmiyorum\" deme — denemeden önce araştır, dene, sonra raporla",
  "workflow_type": "feature"
}